import { useState } from "react";
import { useLoading } from "../../context/LoadingContext";
import { useNavigate } from "react-router-dom";

import api from "../../utils/api";
import "./login.css";
import Input from "../../components/Input";
import ButtonPrimary from "../../components/ButtonPrimary";

export default function Login() {
  const [credentials, setCredentials] = useState({
    email: "",
    password: "",
  });

  const [errors, setErrors] = useState("");
  const navigate = useNavigate();

  const { showLoading, hideLoading } = useLoading();

  const login = async () => {
    try {
      showLoading();

      const response = await api.post("/login", credentials);

      localStorage.setItem("token", response.data.token);
      navigate("/administracao");
    } catch (error) {
      console.error("Erro ao realizar login:", error);
      setErrors(error?.response?.data?.message || "Usuário ou senha inválidos");
    } finally {
      hideLoading();
    }
  };

  const handleChangeCredentials = (event) => {
    const { name, value } = event.target;

    setCredentials((prev) => ({
      ...prev,
      [name]: value,
    }));
  };

  return (
    <div className="login-page">
      <div className="login-card">
        {errors ? <span className="erros"> Não autorizado.</span> : ""}
        <svg
          width="120"
          height="39"
          viewBox="0 0 120 39"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M15 2H24C31.1797 2 37 7.8203 37 15V24C37 31.1797 31.1797 37 24 37H15C7.8203 37 2 31.1797 2 24V15C2 7.8203 7.8203 2 15 2Z"
            stroke="#48718A"
            strokeWidth="4"
          />
          <path
            d="M30.8332 11L16.6248 27.5L10.1665 20"
            stroke="#48718A"
            strokeWidth="4"
            strokeLinecap="round"
            strokeLinejoin="round"
          />
          <path
            d="M61.5739 13.6364C61.446 12.5568 60.9276 11.7188 60.0185 11.1222C59.1094 10.5256 57.9943 10.2273 56.6733 10.2273C55.7074 10.2273 54.8622 10.3835 54.1378 10.696C53.4205 11.0085 52.8594 11.4382 52.4545 11.9851C52.0568 12.532 51.858 13.1534 51.858 13.8494C51.858 14.4318 51.9964 14.9325 52.2734 15.3516C52.5575 15.7635 52.9197 16.108 53.3601 16.3849C53.8004 16.6548 54.2621 16.8786 54.745 17.0561C55.228 17.2266 55.6719 17.3651 56.0767 17.4716L58.2926 18.0682C58.8608 18.2173 59.4929 18.4233 60.1889 18.6861C60.892 18.9489 61.5632 19.3075 62.2024 19.7621C62.8487 20.2095 63.3814 20.7848 63.8004 21.4879C64.2195 22.1911 64.429 23.054 64.429 24.0767C64.429 25.2557 64.12 26.321 63.5021 27.2727C62.8913 28.2244 61.9964 28.9808 60.8175 29.5419C59.6456 30.103 58.2216 30.3835 56.5455 30.3835C54.983 30.3835 53.63 30.1314 52.4865 29.6271C51.3501 29.1229 50.4553 28.4197 49.8018 27.5178C49.1555 26.6158 48.7898 25.5682 48.7045 24.375H51.4318C51.5028 25.1989 51.7798 25.8807 52.2628 26.4205C52.7528 26.9531 53.3707 27.3509 54.1165 27.6136C54.8693 27.8693 55.679 27.9972 56.5455 27.9972C57.554 27.9972 58.4595 27.8338 59.2621 27.5071C60.0646 27.1733 60.7003 26.7116 61.169 26.1222C61.6378 25.5256 61.8722 24.8295 61.8722 24.0341C61.8722 23.3097 61.6697 22.7202 61.2649 22.2656C60.8601 21.8111 60.3274 21.4418 59.6669 21.1577C59.0064 20.8736 58.2926 20.625 57.5256 20.4119L54.8409 19.6449C53.1364 19.1548 51.7869 18.4553 50.7926 17.5462C49.7983 16.6371 49.3011 15.4474 49.3011 13.9773C49.3011 12.7557 49.6314 11.6903 50.2919 10.7812C50.9595 9.86506 51.8544 9.15483 52.9766 8.65057C54.1058 8.1392 55.3665 7.88352 56.7585 7.88352C58.1648 7.88352 59.4148 8.13565 60.5085 8.63991C61.6023 9.13707 62.4688 9.81889 63.108 10.6854C63.7543 11.5518 64.0952 12.5355 64.1307 13.6364H61.5739ZM67.432 30V13.6364H69.9462V30H67.432ZM68.7104 10.9091C68.2203 10.9091 67.7978 10.7422 67.4426 10.4084C67.0946 10.0746 66.9206 9.6733 66.9206 9.20455C66.9206 8.7358 67.0946 8.33452 67.4426 8.00071C67.7978 7.6669 68.2203 7.5 68.7104 7.5C69.2005 7.5 69.6195 7.6669 69.9675 8.00071C70.3226 8.33452 70.5002 8.7358 70.5002 9.20455C70.5002 9.6733 70.3226 10.0746 69.9675 10.4084C69.6195 10.7422 69.2005 10.9091 68.7104 10.9091ZM80.6676 13.6364V15.767H72.1875V13.6364H80.6676ZM74.6591 9.71591H77.1733V25.3125C77.1733 26.0227 77.2763 26.5554 77.4822 26.9105C77.6953 27.2585 77.9652 27.4929 78.2919 27.6136C78.6257 27.7273 78.9773 27.7841 79.3466 27.7841C79.6236 27.7841 79.8509 27.7699 80.0284 27.7415C80.206 27.706 80.348 27.6776 80.4545 27.6562L80.9659 29.9148C80.7955 29.9787 80.5575 30.0426 80.2521 30.1065C79.9467 30.1776 79.5597 30.2131 79.0909 30.2131C78.3807 30.2131 77.6847 30.0604 77.0028 29.755C76.3281 29.4496 75.767 28.9844 75.3196 28.3594C74.8793 27.7344 74.6591 26.946 74.6591 25.9943V9.71591ZM90.1346 30.3409C88.5579 30.3409 87.1978 29.9929 86.0543 29.2969C84.918 28.5938 84.0408 27.6136 83.4229 26.3565C82.8121 25.0923 82.5067 23.6222 82.5067 21.946C82.5067 20.2699 82.8121 18.7926 83.4229 17.5142C84.0408 16.2287 84.9002 15.2273 86.0011 14.5099C87.109 13.7855 88.4016 13.4233 89.8789 13.4233C90.7312 13.4233 91.5728 13.5653 92.4038 13.8494C93.2347 14.1335 93.9911 14.5952 94.6729 15.2344C95.3548 15.8665 95.8981 16.7045 96.3029 17.7486C96.7077 18.7926 96.9102 20.0781 96.9102 21.6051V22.6705H84.2965V20.4972H94.3533C94.3533 19.5739 94.1687 18.75 93.7994 18.0256C93.4371 17.3011 92.9187 16.7294 92.244 16.3104C91.5763 15.8913 90.788 15.6818 89.8789 15.6818C88.8775 15.6818 88.011 15.9304 87.2795 16.4276C86.555 16.9176 85.9975 17.5568 85.6069 18.3452C85.2163 19.1335 85.021 19.9787 85.021 20.8807V22.3295C85.021 23.5653 85.234 24.6129 85.6602 25.4723C86.0934 26.3246 86.6935 26.9744 87.4606 27.4219C88.2276 27.8622 89.119 28.0824 90.1346 28.0824C90.7951 28.0824 91.3917 27.9901 91.9244 27.8054C92.4641 27.6136 92.9293 27.3295 93.32 26.9531C93.7106 26.5696 94.0124 26.0937 94.2255 25.5256L96.6545 26.2074C96.3988 27.0312 95.9691 27.7557 95.3654 28.3807C94.7617 28.9986 94.016 29.4815 93.1282 29.8295C92.2404 30.1705 91.2425 30.3409 90.1346 30.3409ZM111.326 17.3011L109.067 17.9403C108.925 17.5639 108.716 17.1982 108.439 16.843C108.169 16.4808 107.799 16.1825 107.331 15.9482C106.862 15.7138 106.262 15.5966 105.53 15.5966C104.529 15.5966 103.694 15.8274 103.027 16.2891C102.366 16.7436 102.036 17.3224 102.036 18.0256C102.036 18.6506 102.263 19.1442 102.718 19.5064C103.172 19.8686 103.882 20.1705 104.848 20.4119L107.277 21.0085C108.74 21.3636 109.831 21.907 110.548 22.6385C111.265 23.3629 111.624 24.2969 111.624 25.4403C111.624 26.3778 111.354 27.2159 110.814 27.9545C110.282 28.6932 109.536 29.2756 108.577 29.7017C107.618 30.1278 106.503 30.3409 105.232 30.3409C103.563 30.3409 102.181 29.9787 101.088 29.2543C99.994 28.5298 99.3015 27.4716 99.0103 26.0795L101.397 25.483C101.624 26.3636 102.054 27.0241 102.686 27.4645C103.325 27.9048 104.159 28.125 105.189 28.125C106.361 28.125 107.292 27.8764 107.98 27.3793C108.676 26.875 109.025 26.2713 109.025 25.5682C109.025 25 108.826 24.5241 108.428 24.1406C108.03 23.75 107.419 23.4588 106.596 23.267L103.868 22.6278C102.37 22.2727 101.269 21.7223 100.566 20.9766C99.8697 20.2237 99.5217 19.2827 99.5217 18.1534C99.5217 17.2301 99.7809 16.4134 100.299 15.7031C100.825 14.9929 101.539 14.4354 102.441 14.0305C103.35 13.6257 104.38 13.4233 105.53 13.4233C107.15 13.4233 108.421 13.7784 109.344 14.4886C110.275 15.1989 110.935 16.1364 111.326 17.3011Z"
            fill="#344054"
          />
          <path
            d="M116.795 30.3409C115.971 30.3409 115.264 30.0533 114.675 29.478C114.093 28.8956 113.805 28.1889 113.812 27.358C113.805 26.5483 114.093 25.8558 114.675 25.2805C115.264 24.7053 115.971 24.4176 116.795 24.4176C117.576 24.4176 118.265 24.7053 118.862 25.2805C119.465 25.8558 119.771 26.5483 119.778 27.358C119.771 27.9119 119.625 28.4162 119.341 28.8707C119.064 29.3182 118.702 29.6768 118.254 29.9467C117.807 30.2095 117.32 30.3409 116.795 30.3409Z"
            fill="#48718A"
          />
        </svg>

        <div className="login-header">
          <h1>Bem-vindo</h1>
          <p>Acesse sua conta para continuar</p>
        </div>

        <form
          className="login-form"
          onSubmit={(event) => {
            event.preventDefault();
            login();
          }}
        >
          <Input
            name="email"
            type="email"
            placeholder="E-mail"
            value={credentials.email}
            onChange={handleChangeCredentials}
          />

          <Input
            name="password"
            type="password"
            placeholder="Senha"
            value={credentials.password}
            onChange={handleChangeCredentials}
          />

          <ButtonPrimary type="submit">Acessar</ButtonPrimary>
        </form>

        <div className="login-footer">
          <span>© 2025 • Sites Laon</span>
        </div>
      </div>
    </div>
  );
}
